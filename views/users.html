<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>User Profile</title>
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
</head>

  <div class="container">
    <div class="page-header">
      <h1>Traction.io <small>Curated educational content for everyone</small></h1>
    </div>
    <div class="row">
      <div class="col-xs-6 col-md-3">
        <a href="#" class="thumbnail" style="width: 220px; height: 220px;"}>
          <img src="https://avatars1.githubusercontent.com/u/1704069?v=3&s=460" alt="Troy's github avatar">
        </a>
      </div>
      <div class="userProfileInfo">
      </div>
    </div>

    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">Articles published:</h3>
      </div>
      <div class="panel-body">
        <div class="userArticleInfo">
        </div>
      </div>
    </div>

    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">Edits published:</h3>
      </div>
      <div class="panel-body">
        <div class="userSectionInfo">  
        </div>
      </div>
    </div>

    <div class="panel panel-warning">
      <div class="panel-heading">
        <h3 class="panel-title">Edits awaiting your approval:</h3>
      </div>
      <div class="panel-body">
        <div class="userPendingInfo">
        </div>
      </div>
    </div>
  </div>

  <!-- template scripts -->
  <!-- Basic user info template -->
  <script id="user-profile-template" type="text/x-handlebars-template">
    <h1>{{user.name}} <br /><small>{{user.userName}}<br /> {{user.email}}</small></h1>
  </script>
  <!-- User articles template -->
  <script id="article-info-template" type="text/x-handlebars-template">
    {{#each articleCollection}}
      <p><u>{{subject}}</u>, {{created}}</p>
    {{/each}}
  </script>

  <!-- Collection templates -->
  <!-- Edits published by user template -->
  <script id="section-info-template" type="text/x-handlebars-template">
    {{#each sectionCollection}}
      <p><u>{{title}}</u>, {{created}}</p>
    {{/each}}
  </script>
  <!-- Edits awaiting user to approve -->
  <script id="pending-info-template" type="text/x-handlebars-template">
    {{#each pendingCollection}}
      <p><u>Edit suggested by <b>{{userName}}:</b></u> {{body}}</p>
    {{/each}}
  </script>
  <!-- Dependency scripts -->
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.2/underscore-min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js"></script>
  
  <!-- Backbone stuff -->
  <script>
    //Define models

    var User = Backbone.Model.extend({
      defaults: {
        name: '',
        userName: '', 
        email: ''
      }
    });

    var Article = Backbone.Model.extend({
      defaults: {
        subject: '',
        created: ''
      }
      // url: function(){
      //   return 'http://localhost:3000/article/' + this.id;
      // }
    });

    var Section = Backbone.Model.extend({
      defaults: {
        title: '',
        created: '',
        approved: ''
      }
    });

    var Pending = Backbone.Model.extend({
      defaults: {
        userName: '',
        owner_id: '',
        approved: false,
        body: ''
      }
    }); 

    //Define collections

    var ArticleCollection = Backbone.Collection.extend({
      model: Article,
      comparator: function(model) {
        return model.get('created');
      }
    });

    var SectionCollection = Backbone.Collection.extend({
      model: Section,
      comparator: function(model) {
        return model.get('created');
      }
    });

    var PendingCollection = Backbone.Collection.extend({
      model: Pending,
      comparator: function(model) {
        return model.get('userName');
      }
    });

    //Define views

    var UserView = Backbone.View.extend({
      className: "user",
      render: function() {
        this.$el.html('');
        var source = $("#user-profile-template").html();
        var template = Handlebars.compile(source);
        var rendered = template({user: this.model.toJSON()});
        this.$el.append(rendered);
        return this;
      }
    });

    var ArticleView = Backbone.View.extend({
      className: 'article',
      initialize: function() {
        this.listenTo(this.collection, 'add change remove', this.render);
      },
      render: function() {
        this.$el.html('');
        var source = $("#article-info-template").html();
        var template = Handlebars.compile(source);
        var rendered = template({articleCollection: this.collection.toJSON()});
        this.$el.append(rendered);
        return this;
      }
    });

    var SectionView = Backbone.View.extend({
      className: 'section',
      initialize: function() {
        this.listenTo(this.collection, 'add change remove', this.render);
      },
      render: function() {
        this.$el.html('');
        var source = $("#section-info-template").html();
        var template = Handlebars.compile(source);
        var rendered = template({sectionCollection: this.collection.toJSON()});
        this.$el.append(rendered);
        return this;
      }
    });

    var PendingView = Backbone.View.extend({
      className: 'pending',
      initialize: function() {
        this.listenTo(this.collection, 'add change remove', this.render);
      },
      render: function() {
        this.$el.html('');
        var source = $("#pending-info-template").html();
        var template = Handlebars.compile(source);
        var rendered = template({pendingCollection: this.collection.toJSON()});
        this.$el.append(rendered);
        return this;
      }
    });

  //instantiations

    //models
    var user = new User({
      name: 'Troy Sultan',
      userName: 'destroysultan', 
      email: 'troysultan@gmail.com'
    });

    var article = new Article({
      subject: 'Awesome Subject',
      created: '2015-03-20T22:45:29.994Z'
    });

    var article2 = new Article({
      subject: 'Awesome Subject numba 2',
      created: '2015-03-20T22:45:35.994Z'
    });

    var section = new Section({
      title: 'More examples (section title)',
      created: '2015-03-20T22:45:30.005Z',
      approved: true
    });

    var section2 = new Section({
      title: 'Even more examples (section title)',
      created: '2015-03-20T23:55:50.005Z',
      approved: false
    });

    var pending = new Pending({
      userName: 'Wen',
      owner_id: '1',
      approved: false,
      body: 'I disagree with this point- wireframing is meant to be most..'
    });

    //collections
    var articleCollection = new ArticleCollection([article, article2]);

    var sectionCollection = new SectionCollection([section, section2]);

    var pendingCollection = new PendingCollection([pending]);

    //views
    var userView = new UserView({
      model: user
    });

    var articleView = new ArticleView({
      collection: articleCollection
    });

    var sectionView = new SectionView({
      collection: sectionCollection
    });

    var pendingView = new PendingView({
      collection: pendingCollection
    });

    $(document).ready(function() {
      $('.userProfileInfo').append(userView.render().$el);
      $('.userArticleInfo').append(articleView.render().$el);
      $('.userSectionInfo').append(sectionView.render().$el);
      $('.userPendingInfo').append(pendingView.render().$el);
    });
  </script>
</body>

</html>